<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Baqend JavaScript SDK 2.0.1 - Source: caching/BloomFilter.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="shortcut icon" type="image/x-icon" href="img/favicon.ico">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap-baqend.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="/"><img src="img/baqend_logo.svg"></a>
        </div>

        <!-- Expanded navigation -->
        <div id="nav" class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
                <li>
                    <a href="http://www.baqend.com/guide/index.html">Guide</a>
                </li>
                <li class="active">
                    <a href="baqend.html">JS API</a>
                </li>
                <li>
                    <a href="http://www.baqend.com/#tutorial">Tutorial</a>
                </li>
                <li>
                    <a href="http://dashboard.baqend.com/">Dashboard</a>
                </li>
                <li>
                    <a href="https://community.baqend.com/">Community <span class="visible-lg-inline">Forum</span></a>
                </li>
            </ul>
        </div>
    </div>
</nav>


<div class="container">
  <div class="row">
    <div class="col-md-3">
        <div class="bs-sidebar hidden-print fixed affix" role="complementary">
            <input class="filter form-control input-sm" type="text" placeholder="FILTER"/>

            <ul class="nav bs-sidenav">
            
            
                <li class="">
                    <a href="baqend.html" class="nav-name">baqend</a>
                    <ul class="nav">
                      
                        <li class=""><a href="baqend.EntityManager.html" class="nav-name">EntityManager</a></li>
                      
                        <li class=""><a href="baqend.EntityManagerFactory.html" class="nav-name">EntityManagerFactory</a></li>
                      
                        <li class=""><a href="baqend.EntityTransaction.html" class="nav-name">EntityTransaction</a></li>
                      
                        <li class=""><a href="baqend.GeoPoint.html" class="nav-name">GeoPoint</a></li>
                      
                        <li class=""><a href="baqend.Query.html" class="nav-name">Query</a></li>
                      
                    </ul>
                </li>
            
                <li class="">
                    <a href="baqend.binding.html" class="nav-name">baqend.binding</a>
                    <ul class="nav">
                      
                        <li class=""><a href="baqend.binding.Accessor.html" class="nav-name">Accessor</a></li>
                      
                        <li class=""><a href="baqend.binding.DeviceFactory.html" class="nav-name">DeviceFactory</a></li>
                      
                        <li class=""><a href="baqend.binding.Enhancer.html" class="nav-name">Enhancer</a></li>
                      
                        <li class=""><a href="baqend.binding.Entity.html" class="nav-name">Entity</a></li>
                      
                        <li class=""><a href="baqend.binding.EntityFactory.html" class="nav-name">EntityFactory</a></li>
                      
                        <li class=""><a href="baqend.binding.Managed.html" class="nav-name">Managed</a></li>
                      
                        <li class=""><a href="baqend.binding.ManagedFactory.html" class="nav-name">ManagedFactory</a></li>
                      
                        <li class=""><a href="baqend.binding.Role.html" class="nav-name">Role</a></li>
                      
                        <li class=""><a href="baqend.binding.User.html" class="nav-name">User</a></li>
                      
                        <li class=""><a href="baqend.binding.UserFactory.html" class="nav-name">UserFactory</a></li>
                      
                    </ul>
                </li>
            
                <li class="">
                    <a href="baqend.caching.html" class="nav-name">baqend.caching</a>
                    <ul class="nav">
                      
                        <li class=""><a href="baqend.caching.BloomFilter.html" class="nav-name">BloomFilter</a></li>
                      
                    </ul>
                </li>
            
                <li class="">
                    <a href="baqend.connector.html" class="nav-name">baqend.connector</a>
                    <ul class="nav">
                      
                        <li class=""><a href="baqend.connector.Connector.html" class="nav-name">Connector</a></li>
                      
                        <li class=""><a href="baqend.connector.IFrameConnector.html" class="nav-name">IFrameConnector</a></li>
                      
                        <li class=""><a href="baqend.connector.Message.html" class="nav-name">Message</a></li>
                      
                        <li class=""><a href="baqend.connector.NodeConnector.html" class="nav-name">NodeConnector</a></li>
                      
                        <li class=""><a href="baqend.connector.XMLHttpConnector.html" class="nav-name">XMLHttpConnector</a></li>
                      
                    </ul>
                </li>
            
                <li class="">
                    <a href="baqend.error.html" class="nav-name">baqend.error</a>
                    <ul class="nav">
                      
                        <li class=""><a href="baqend.error.CommunicationError.html" class="nav-name">CommunicationError</a></li>
                      
                        <li class=""><a href="baqend.error.EntityExistsError.html" class="nav-name">EntityExistsError</a></li>
                      
                        <li class=""><a href="baqend.error.IllegalEntityError.html" class="nav-name">IllegalEntityError</a></li>
                      
                        <li class=""><a href="baqend.error.PersistentError.html" class="nav-name">PersistentError</a></li>
                      
                        <li class=""><a href="baqend.error.RollbackError.html" class="nav-name">RollbackError</a></li>
                      
                    </ul>
                </li>
            
                <li class="">
                    <a href="baqend.metamodel.html" class="nav-name">baqend.metamodel</a>
                    <ul class="nav">
                      
                        <li class=""><a href="baqend.metamodel.Attribute.html" class="nav-name">Attribute</a></li>
                      
                        <li class=""><a href="baqend.metamodel.BasicType.html" class="nav-name">BasicType</a></li>
                      
                        <li class=""><a href="baqend.metamodel.CollectionAttribute.html" class="nav-name">CollectionAttribute</a></li>
                      
                        <li class=""><a href="baqend.metamodel.DbIndex.html" class="nav-name">DbIndex</a></li>
                      
                        <li class=""><a href="baqend.metamodel.EmbeddableType.html" class="nav-name">EmbeddableType</a></li>
                      
                        <li class=""><a href="baqend.metamodel.EntityType.html" class="nav-name">EntityType</a></li>
                      
                        <li class=""><a href="baqend.metamodel.ListAttribute.html" class="nav-name">ListAttribute</a></li>
                      
                        <li class=""><a href="baqend.metamodel.ManagedType.html" class="nav-name">ManagedType</a></li>
                      
                        <li class=""><a href="baqend.metamodel.MapAttribute.html" class="nav-name">MapAttribute</a></li>
                      
                        <li class=""><a href="baqend.metamodel.Metamodel.html" class="nav-name">Metamodel</a></li>
                      
                        <li class=""><a href="baqend.metamodel.ModelBuilder.html" class="nav-name">ModelBuilder</a></li>
                      
                        <li class=""><a href="baqend.metamodel.PluralAttribute.html" class="nav-name">PluralAttribute</a></li>
                      
                        <li class=""><a href="baqend.metamodel.SetAttribute.html" class="nav-name">SetAttribute</a></li>
                      
                        <li class=""><a href="baqend.metamodel.SingularAttribute.html" class="nav-name">SingularAttribute</a></li>
                      
                        <li class=""><a href="baqend.metamodel.Type.html" class="nav-name">Type</a></li>
                      
                    </ul>
                </li>
            
                <li class="">
                    <a href="baqend.util.html" class="nav-name">baqend.util</a>
                    <ul class="nav">
                      
                        <li class=""><a href="baqend.util.Acl.html" class="nav-name">Acl</a></li>
                      
                        <li class=""><a href="baqend.util.Code.html" class="nav-name">Code</a></li>
                      
                        <li class=""><a href="baqend.util.Lockable.html" class="nav-name">Lockable</a></li>
                      
                        <li class=""><a href="baqend.util.Logger.html" class="nav-name">Logger</a></li>
                      
                        <li class=""><a href="baqend.util.Metadata.html" class="nav-name">Metadata</a></li>
                      
                        <li class=""><a href="baqend.util.Modules.html" class="nav-name">Modules</a></li>
                      
                        <li class=""><a href="baqend.util.Permission.html" class="nav-name">Permission</a></li>
                      
                        <li class=""><a href="baqend.util.PushMessage.html" class="nav-name">PushMessage</a></li>
                      
                        <li class=""><a href="baqend.util.TokenStorage.html" class="nav-name">TokenStorage</a></li>
                      
                        <li class=""><a href="baqend.util.ValidationResult.html" class="nav-name">ValidationResult</a></li>
                      
                        <li class=""><a href="baqend.util.Validator.html" class="nav-name">Validator</a></li>
                      
                    </ul>
                </li>
            
            </ul>
        </div>
    </div>
    <div class="col-md-9" id="main">
      <h1 class="page-title">Source: caching/BloomFilter.js</h1>

      



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";
var atob = require("../util").atob;

/**
 * @alias baqend.caching.BloomFilter
 */
class BloomFilter {
  constructor(rawBF) {
    this.bytes = atob(rawBF.b);
    this.bits = rawBF.m;
    this.hashes = rawBF.h;
  }

  contains(element) {
    for (let hash of BloomFilter._getHashes(element, this.bits, this.hashes)) {
      if (!this._isSet(hash)) {
        return false;
      }
    }
    return true;
  }

  _isSet(index) {
    var pos = Math.floor(index / 8);
    var bit = 1 &lt;&lt; (index % 8);
    //Extract byte as int or NaN if out of range
    var byte = this.bytes.charCodeAt(pos);
    //Bit-wise AND should be non-zero (NaN always yields false)
    return (byte &amp; bit) != 0;
  }

  static _getHashes(element, bits, hashes) {
    var hashValues = new Array(this.hashes);
    var hash1 = BloomFilter._murmur3(0, element);
    var hash2 = BloomFilter._murmur3(hash1, element);
    for (let i = 0; i &lt; hashes; i++) {
      hashValues[i] = (hash1 + i * hash2) % bits;
    }
    return hashValues;
  }

  static _murmur3(seed, key) {
    var remainder, bytes, h1, h1b, c1, c2, k1, i;
    remainder = key.length &amp; 3;
    bytes = key.length - remainder;
    h1 = seed;
    c1 = 0xcc9e2d51;
    c2 = 0x1b873593;
    i = 0;

    while (i &lt; bytes) {
      k1 =
          ((key.charCodeAt(i) &amp; 0xff)) |
          ((key.charCodeAt(++i) &amp; 0xff) &lt;&lt; 8) |
          ((key.charCodeAt(++i) &amp; 0xff) &lt;&lt; 16) |
          ((key.charCodeAt(++i) &amp; 0xff) &lt;&lt; 24);
      ++i;

      k1 = ((((k1 &amp; 0xffff) * c1) + ((((k1 >>> 16) * c1) &amp; 0xffff) &lt;&lt; 16))) &amp; 0xffffffff;
      k1 = (k1 &lt;&lt; 15) | (k1 >>> 17);
      k1 = ((((k1 &amp; 0xffff) * c2) + ((((k1 >>> 16) * c2) &amp; 0xffff) &lt;&lt; 16))) &amp; 0xffffffff;

      h1 ^= k1;
      h1 = (h1 &lt;&lt; 13) | (h1 >>> 19);
      h1b = ((((h1 &amp; 0xffff) * 5) + ((((h1 >>> 16) * 5) &amp; 0xffff) &lt;&lt; 16))) &amp; 0xffffffff;
      h1 = (((h1b &amp; 0xffff) + 0x6b64) + ((((h1b >>> 16) + 0xe654) &amp; 0xffff) &lt;&lt; 16));
    }

    k1 = 0;

    switch (remainder) {
      case 3:
        k1 ^= (key.charCodeAt(i + 2) &amp; 0xff) &lt;&lt; 16;
      case 2:
        k1 ^= (key.charCodeAt(i + 1) &amp; 0xff) &lt;&lt; 8;
      case 1:
        k1 ^= (key.charCodeAt(i) &amp; 0xff);

        k1 = (((k1 &amp; 0xffff) * c1) + ((((k1 >>> 16) * c1) &amp; 0xffff) &lt;&lt; 16)) &amp; 0xffffffff;
        k1 = (k1 &lt;&lt; 15) | (k1 >>> 17);
        k1 = (((k1 &amp; 0xffff) * c2) + ((((k1 >>> 16) * c2) &amp; 0xffff) &lt;&lt; 16)) &amp; 0xffffffff;
        h1 ^= k1;
    }

    h1 ^= key.length;

    h1 ^= h1 >>> 16;
    h1 = (((h1 &amp; 0xffff) * 0x85ebca6b) + ((((h1 >>> 16) * 0x85ebca6b) &amp; 0xffff) &lt;&lt; 16)) &amp; 0xffffffff;
    h1 ^= h1 >>> 13;
    h1 = ((((h1 &amp; 0xffff) * 0xc2b2ae35) + ((((h1 >>> 16) * 0xc2b2ae35) &amp; 0xffff) &lt;&lt; 16))) &amp; 0xffffffff;
    h1 ^= h1 >>> 16;

    return h1 >>> 0;
  }

}

module.exports = BloomFilter;</code></pre>
        </article>
    </section>





      <footer>
        Baqend JavaScript SDK 2.0.1 &copy 2015 Baqend GmbH<br>
        Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Tue, 26 Apr 2016 15:48:12 GMT
      </footer>
    </div>
  </div>
</div>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
<script src="scripts/filter.js"> </script>
</body>
</html>
